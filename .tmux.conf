
bind r source-file ~/.tmux.conf

unbind C-b
set -g prefix `
bind ` send-prefix

bind 'c' new-window -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"
bind '-' split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

bind k kill-session

# Has to be one of screen* variant otherwise won't work properly.
# See tmux FAQ https://github.com/tmux/tmux/wiki/FAQ
set -g default-terminal screen-256color

set -g set-titles on
set -g set-titles-string "tmux - #{window_name}:#{s|$HOME|~|:pane_current_path}"

set -g history-limit 10000

set -g status-position top
set -g status-bg white
set -g status-fg default
set -g status-left '#{?client_prefix,#[bg=brightblack fg=white] `#{session_name}`,#[bg=white fg=brightblack]  #{session_name} } '
if -b '[[ -z $DISPLAY ]]' \
   "set -g status-right '#[fg=brightblack] #(battery) | #(date \"+%a %d %b %I:%M %p\") '" \
   "set -g status-right ''"

set-hook -g window-linked \
  'if -F "#{==:#{session_windows},1}" \
  "set status off" \
  "set status on" \
  '
set-hook -g window-unlinked \
  'if -F "#{==:#{session_windows},1}" \
  "set status off" \
  "set status on" \
  '

bind M-s set synchronize-panes

set -g window-status-format " #{window_index}:#{window_name}:#{s|$HOME|~|:pane_current_path}#{?pane_synchronized,<sync>,} "
set -g window-status-style 'fg=brightblack'
set -g window-status-current-format " #[fg=brightblack]#{window_index}:#[fg=default]#{window_name}:#{s|$HOME|~|:pane_current_path}#{?pane_synchronized,#[fg=brightred]<sync>,} "
if -b '[[ $TERM == "linux" ]]' \
    "set -g window-status-current-style 'bg=black'" \
    "set -g window-status-current-style 'bg=brightwhite'"

set -g pane-border-status off
set -g pane-border-format "#{?pane_active,#[bg=blue fg=brightwhite bold],#[fg=brightblack]} â†™ #{pane_current_command}:#{s|$HOME|~|:pane_current_path} #[bg=default fg=default]"
set -g pane-border-style 'fg=brightblack'
set -g pane-active-border-style 'fg=blue bold'

set-hook -g after-split-window \
    "setw pane-border-status top"

set-hook -g pane-exited \
    "if -F '#{==:#{window_panes},1}' \
        'setw pane-border-status off'"

set -g mouse on
bind M-m set mouse

setw -g aggressive-resize

set -g word-separators " @*?_-.[]~=/&;!#$%^(){}<>'\""

bind-key -T copy-mode C-Left send-keys -X previous-word
bind-key -T copy-mode C-Right send-keys -X next-word-end

bind -T copy-mode C-g \
     if 'test #{selection_present} = 1' \
     'send -X clear-selection' \
     'send -X cancel'

# Keyboard copy/paste with system clipboard integration

bind -T copy-mode C-w \
    send -X copy-pipe "tmux-copy-to-clipboard" \; \
    send -X clear-selection

bind -T copy-mode M-w \
    send -X copy-pipe "tmux-copy-to-clipboard" \; \
    send -X clear-selection

# Ctrl Insert
bind -T copy-mode C-IC \
    send -X copy-pipe "tmux-copy-to-clipboard" \; \
    send -X clear-selection

# Shift Insert
bind S-IC run 'tmux-copy-from-clipboard' \; pasteb -p
bind ']' run 'tmux-copy-from-clipboard' \; pasteb -p
bind C-y run 'tmux-copy-from-clipboard' \; pasteb -p

update_paste='run "b=%% && tmux pasteb -p -b \$b && tmux saveb -b \$b - | tmux-copy-to-clipboard"'
bind '=' choose-buffer -F "#{buffer_sample}" $update_paste
bind M-y choose-buffer -F "#{buffer_sample}" $update_paste

# C-y is also a paste command in command-prompt and it's not configurable,
# therefore override ':' (default) to update clipboard before opening.
bind ':' run 'tmux-copy-from-clipboard' \; command-prompt

# Mouse drag to select

bind -T copy-mode MouseDragEnd1Pane \
     select-pane

# Mouse double click to copy word

bind -T copy-mode DoubleClick1Pane \
    select-pane \; \
    send -X select-word \; \
    send -X copy-pipe "tmux-copy-to-clipboard"

bind -n DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send -X select-word \; \
    send -X copy-pipe "tmux-copy-to-clipboard"

# Mouse triple click to copy line

bind -T copy-mode TripleClick1Pane \
    select-pane \; \
    send -X select-line \; \
    send -X copy-pipe "tmux-copy-to-clipboard"

bind -n TripleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send -X select-line

# Mouse drag to copy selection

bind -T copy-mode MouseDragEnd1Pane \
    send -X copy-pipe "tmux-copy-to-clipboard"

# Mouse middle click to paste

bind -n MouseDown2Pane \
    select-pane \; \
    run 'tmux-copy-from-clipboard' \; \
    pasteb -p

# Scroll to work in less/man etc
# https://github.com/tmux/tmux/issues/157#issuecomment-150612608

bind -n WheelUpPane if -Ft= '#{?pane_in_mode,1,#{mouse_any_flag}}' \
    'send -Mt {{mouse}}' \
    'if -Ft {{mouse}} "#{alternate_on}" \
        "send -t {{mouse}} Up" \
        "copy-mode -et {{mouse}}"'

bind -n WheelDownPane if -Ft = '#{?pane_in_mode,1,#{mouse_any_flag}}' \
    'send -Mt {{mouse}}' \
    'if -Ft {{mouse}} "#{alternate_on}" \
        "send -t {{mouse}} Down" \
        "send -Mt {{mouse}}"'
